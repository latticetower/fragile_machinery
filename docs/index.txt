Описание
========
:Version: 0.1
:TOC: 

== Ограничения версии 0.1
- все объекты, включая достижения игроков, их победы, ники, учетные записи, и тд - в начальной версии хранятся исключительно в памяти и перестают существовать с выключением сервера или отключением игрока
- колода содержит объекты только типа Unit, для всех пользователей она одинаковая
- в начальном варианте защита от некорректного ввода, DDoS и подобных вещей не предусмотрена

== Основные объекты
=== Игровой сервер (класс GameServer)
- осуществляет непосредственное управление играми
- хранит пользователей

=== Пользователь (класс User)
- взаимодействует непосредственно с игровым сервером

Диаграмма состояний: 

image:images/User_state.svg["User states diagram",width=200]

=== Игра (класс Game)
Диаграмма состояний:

image:images/Game_state.svg["Game states diagram", width=300, link="images/Game_state.svg"]

== Сервисные команды
В версии 0.1 взаимодействие клиента с сервером осуществляется по следующему принципу:

- клиент отправляет команду определенного вида (строка)
- в ответ в общем случае получает json

=== Пользовательские команды

- u list - возвращает список пользователей (игроков, подключенных к серверу)
- u rename <nickname> - меняет ник текущего пользователя на <nickname>
- m <message> - команда широковещательный пакет всем подключенным пользователям (сообщение чата с текстом <message>, у получивших отображается в виде <nickname>: <message>)

=== Команды игрового процесса

- g with <user_id> - пользователю с идентификатором <user_id> отправляется приглашение в игру с текущим пользователем
- g accept <user_id> - текущий пользователь принимает приглашение в игру от пользователя с идентификатором <user_id>
- g reject <user_id> - текущий пользователь отклоняет приглашение в игру от пользователя с идентификатором <user_id>
- g hand - команда возвращает список своих карт в руке
- g state - возвращает состояние игрового поля (список открытых карт, состояния баз игроков, количество карт у соперников в руке)
- g put <card_id> - выложить карту из своей руки на стол. идентификатор карты - одно из значений, возвращаемое командой g hand
- g target <object_id> <card_id> - команда указывает цель, на которую действует карта (пока не продумала, возможно, будут еще параметры)
- g next - сообщает о том, что ход текущего игрока завершен
- g giveup - добровольная сдача игрока

== EventMachine. Описание взаимодействия
По идее, должно быть несколько общедоступных каналов, отвечающих за взаимодействие разных частей системы. В частности:

- широковещательный канал для чата
- широковещательный канал со списком игроков (обновляемый с определенной периодичностью)
- канал игры (куда падают все изменения открытых частей игры - то есть, количество карт в руках у игроков, состояние карт на столе, и тд)

Полезные ссылки

- http://pusher.com/docs/client_api_guide/client_channels
- https://gist.github.com/jShaf/1d99514dbbdb69f5c4b6


